<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI æ¨¡å‹æ€§èƒ½æ’è¡Œæ¦œ</title>
    <script src="https://cdn.tailwindcss.com"></script> <!-- ä½¿ç”¨ TailwindCSS å¿«é€Ÿæ ·å¼ -->
    <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script> <!-- ä½¿ç”¨ Vue3 -->
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
</head>
<body class="bg-gray-50 text-gray-800">

<div id="app" class="max-w-7xl mx-auto p-6">
    
    <!-- é¡¶éƒ¨æ ‡é¢˜ -->
    <div class="flex justify-between items-center mb-8">
        <div>
            <h1 class="text-3xl font-bold text-gray-900">ğŸš€ AI æ¨¡å‹å®æ—¶æ€§èƒ½æ¦œ</h1>
            <p class="text-gray-500 mt-2">å®æ—¶æµ‹é€Ÿï¼šååé‡ Â· å»¶è¿Ÿ Â· ä»·æ ¼ Â· æ€§ä»·æ¯”</p>
        </div>
        <button @click="refreshData()" :disabled="loading" 
                class="px-6 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 disabled:opacity-50 transition shadow-sm">
            <span v-if="loading"><i class="fas fa-spinner fa-spin mr-2"></i> æµ‹é€Ÿä¸­...</span>
            <span v-else><i class="fas fa-play mr-2"></i> ç«‹å³æµ‹é€Ÿ</span>
        </button>
    </div>

    <!-- åˆ—è¡¨å¡ç‰‡ -->
    <div class="bg-white rounded-xl shadow-sm border border-gray-200 overflow-hidden">
        <table class="w-full text-left border-collapse">
            <thead>
                <tr class="bg-gray-50 text-gray-500 text-sm uppercase tracking-wider border-b border-gray-200">
                    <th class="p-4 font-medium">æœåŠ¡å•† / æ¨¡å‹</th>
                    <th class="p-4 font-medium">ä¸Šä¸‹æ–‡ & è¾“å‡º</th>
                    <th class="p-4 font-medium">ä»·æ ¼ (CNY/1M)</th>
                    <th class="p-4 font-medium">ååé‡ (Tokens/s)</th>
                    <th class="p-4 font-medium">é¦–å­—å»¶è¿Ÿ (TTFT)</th>
                    <th class="p-4 font-medium">æµ‹è¯•æ ·æœ¬</th>
                </tr>
            </thead>
            <tbody class="divide-y divide-gray-100">
                <tr v-for="item in models" :key="item.id" class="hover:bg-blue-50 transition group">
                    <!-- æœåŠ¡å•†ä¿¡æ¯ -->
                    <td class="p-4 align-top">
                        <div class="font-bold text-gray-900 text-lg">{{ item.provider }}</div>
                        <div class="text-sm text-gray-500 bg-gray-100 inline-block px-2 py-0.5 rounded mt-1">{{ item.display_name }}</div>
                    </td>

                    <!-- ä¸Šä¸‹æ–‡ -->
                    <td class="p-4 align-middle">
                        <div class="text-sm text-gray-600">
                            <span class="block"><i class="fas fa-memory w-4 text-gray-400"></i> {{ item.context_window }} ä¸Šä¸‹æ–‡</span>
                            <span class="block mt-1"><i class="fas fa-file-export w-4 text-gray-400"></i> {{ item.max_output }} è¾“å‡º</span>
                        </div>
                    </td>

                    <!-- ä»·æ ¼ -->
                    <td class="p-4 align-middle">
                        <div class="text-sm">
                            <div class="flex items-center space-x-2">
                                <span class="text-gray-400 text-xs w-8">è¾“å…¥</span>
                                <span class="font-mono font-medium">Â¥{{ item.input_price_cny_1m.toFixed(2) }}</span>
                            </div>
                            <div class="flex items-center space-x-2 mt-1">
                                <span class="text-gray-400 text-xs w-8">è¾“å‡º</span>
                                <span class="font-mono font-medium text-orange-600">Â¥{{ item.output_price_cny_1m.toFixed(2) }}</span>
                            </div>
                        </div>
                    </td>

                    <!-- ååé‡ (æ ¸å¿ƒæŒ‡æ ‡) -->
                    <td class="p-4 align-middle">
                        <div class="flex items-end space-x-2">
                            <span class="text-2xl font-bold text-green-600">{{ item.avg_throughput }}</span>
                            <span class="text-sm text-gray-400 mb-1">t/s</span>
                        </div>
                        <div class="w-full bg-gray-200 rounded-full h-1.5 mt-2 overflow-hidden">
                            <div class="bg-green-500 h-1.5 rounded-full" :style="{ width: Math.min(item.avg_throughput, 100) + '%' }"></div>
                        </div>
                    </td>

                    <!-- å»¶è¿Ÿ -->
                    <td class="p-4 align-middle">
                        <div class="flex items-center space-x-2">
                            <span class="text-lg font-medium" :class="getLatencyColor(item.avg_ttft)">
                                {{ (item.avg_ttft * 1000).toFixed(0) }}
                            </span>
                            <span class="text-xs text-gray-400">ms</span>
                        </div>
                    </td>

                     <!-- æ ·æœ¬æ•° -->
                     <td class="p-4 align-middle">
                        <span class="text-xs text-gray-400 bg-gray-100 px-2 py-1 rounded-full">
                            {{ item.success_count }} æ¬¡æµ‹è¯•
                        </span>
                    </td>
                </tr>
            </tbody>
        </table>
    </div>

</div>

<script>
    const { createApp, ref, onMounted } = Vue;

    createApp({
        setup() {
            const models = ref([]);
            const loading = ref(false);

            const fetchData = async () => {
                const res = await fetch('/api/stats');
                models.value = await res.json();
            };

            const refreshData = async () => {
                loading.value = true;
                try {
                    await fetch('/api/refresh', { method: 'POST' });
                    await fetchData();
                } finally {
                    loading.value = false;
                }
            };

            const getLatencyColor = (latency) => {
                if(latency == 0) return 'text-gray-300';
                if(latency < 0.5) return 'text-green-600';
                if(latency < 1.0) return 'text-yellow-600';
                return 'text-red-600';
            };

            onMounted(() => {
                fetchData();
            });

            return {
                models,
                loading,
                refreshData,
                getLatencyColor
            };
        }
    }).mount('#app');
</script>

</body>
</html>
